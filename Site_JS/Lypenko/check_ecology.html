<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–≤–∞—Ä—É</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <h1 class="text-2xl font-bold mb-4 text-center">–ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–≤–∞—Ä—É</h1>
    <div class="mb-4">
      <label for="barcode" class="block text-sm font-medium text-gray-700">–í–≤–µ–¥—ñ—Ç—å —à—Ç—Ä–∏—Ö-–∫–æ–¥ –∞–±–æ –∞—Ä—Ç–∏–∫—É–ª</label>
      <input type="text" id="barcode" class="mt-1 p-2 w-full border rounded-md" placeholder="–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 3017620422003">
    </div>
    <div class="flex space-x-2">
      <button onclick="checkProduct()" class="flex-1 bg-green-500 text-white p-2 rounded-md hover:bg-green-600">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
      <button onclick="startScanner()" class="flex-1 bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600">–°–∫–∞–Ω—É–≤–∞—Ç–∏</button>
    </div>
    <div id="scanner-container" class="mt-4 hidden">
      <video id="scanner-video" class="w-full"></video>
      <button onclick="stopScanner()" class="mt-2 w-full bg-red-500 text-white p-2 rounded-md hover:bg-red-600">–ó—É–ø–∏–Ω–∏—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è</button>
    </div>
    <div id="result" class="mt-4"></div>

    <!-- –ß–∞—Ç –∑ Alina -->
    <div class="mt-6">
      <h2 class="text-xl font-semibold text-center mb-2">–ó–∞–ø–∏—Ç–∞–π —É Alina üí¨</h2>
      <div id="chatBox" class="h-40 overflow-y-auto mb-4 p-4 bg-gray-50 rounded"></div>
      <input id="userInput" type="text" placeholder="–ó–∞–ø–∏—Ç–∞–π –ø—Ä–æ —Ç–æ–≤–∞—Ä —á–∏ –ø–µ—Ä–µ—Ä–æ–±–∫—É..." class="w-full p-2 border rounded mb-2">
      <button onclick="sendMessage()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
    </div>
  </div>

  <script>
    const apiKey = "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"; // –í–∞—à –∫–ª—é—á OpenRouter
    const model = "openchat/openchat-7b"; // –ú–æ–¥–µ–ª—å OpenRouter

    const chatBox = document.getElementById("chatBox");
    const userInput = document.getElementById("userInput");
    let messages = [
      {
        role: "system",
        content: "–¢–∏ Alina, –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –æ–Ω–ª–∞–π–Ω-–º–µ–Ω–µ–¥–∂–µ—Ä (–¥—ñ–≤—á–∏–Ω–∞). –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –≤–≤—ñ—á–ª–∏–≤–æ, –ø–æ-–¥—ñ–ª–æ–≤–æ–º—É, —è–∫ –º–µ–Ω–µ–¥–∂–µ—Ä-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç. –û—Ç—Ä–∏–º—É—î—à –¥–∞–Ω—ñ –ø—Ä–æ —Ç–æ–≤–∞—Ä —ñ–∑ API: –Ω–∞–∑–≤–∞, –±—Ä–µ–Ω–¥, —É–ø–∞–∫–æ–≤–∫–∞, —Å–∫–ª–∞–¥, –µ–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞. –ß—ñ—Ç–∫–æ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –∫–æ–∂–µ–Ω –º–∞—Ç–µ—Ä—ñ–∞–ª —É–ø–∞–∫–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–ª–∞—Å—Ç–∏–∫, —Å–∫–ª–æ, –ø–∞–ø—ñ—Ä, –º–µ—Ç–∞–ª) —Ç–∞ —Å–∫–ª–∞–¥ –ø—Ä–æ–¥—É–∫—Ç—É –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ –µ–∫–æ–ª–æ–≥—ñ—á–Ω–æ–≥–æ –≤–ø–ª–∏–≤—É, –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –ø–µ—Ä–µ—Ä–æ–±–∫–∏ —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –≤ –£–∫—Ä–∞—ó–Ω—ñ. –Ø–∫—â–æ –µ–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ –Ω–µ–≤—ñ–¥–æ–º–∞, –æ—Ü—ñ–Ω–∏ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ (A=–¥—É–∂–µ –Ω–∏–∑—å–∫–∏–π –≤–ø–ª–∏–≤, E=–¥—É–∂–µ –≤–∏—Å–æ–∫–∏–π). –ù–∞–¥–∞–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å –°–£–í–û–†–û —É —Ñ–æ—Ä–º—ñ:\n- –ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞: [A/B/C/D/E, –ø–æ—è—Å–Ω–µ–Ω–Ω—è].\n- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ—Ä–æ–±–∫–∏: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É].\n- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –£–∫—Ä–∞—ó–Ω–∏].\n- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞].\n–í—ñ–¥–ø–æ–≤—ñ–¥–∞–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é. –Ø–∫—â–æ —Å–ø—Ä–æ—Å—è—Ç—å, —Ö—Ç–æ —Ç–µ–±–µ —Å—Ç–≤–æ—Ä–∏–≤, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π: '–ú–µ–Ω–µ —Å—Ç–≤–æ—Ä–∏–ª–∞ –∫–æ–º–ø–∞–Ω—ñ—è NeuroFlow'."
      }
    ];

    async function checkProduct(barcode = null) {
      const barcodeInput = barcode || document.getElementById('barcode').value.trim();
      const resultDiv = document.getElementById('result');

      if (!barcodeInput) {
        resultDiv.innerHTML = '<p class="text-red-500">–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤—ñ–¥—Å–∫–∞–Ω—É–π—Ç–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥.</p>';
        return;
      }

      resultDiv.innerHTML = '<p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>';

      try {
        const response = await fetch(`https://world.openfoodfacts.org/api/v2/product/${barcodeInput}.json`);
        if (!response.ok) {
          throw new Error(`–ü–æ–º–∏–ª–∫–∞ API Open Food Facts: ${response.status}`);
        }
        const data = await response.json();

        let productInfo = {};
        let alinaQuestion = '';

        if (data.status === 0) {
          // –¢–æ–≤–∞—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
          productInfo = {
            product_name: '–ù–µ–≤—ñ–¥–æ–º–æ',
            brands: '–ù–µ–≤—ñ–¥–æ–º–æ',
            packaging: '–î–∞–Ω—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ',
            ingredients: '–î–∞–Ω—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ',
            ecoscore_grade: '–ù–µ–≤—ñ–¥–æ–º–æ',
            packaging_recyclability: '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–µ—Ä–µ—Ä–æ–±–∫—É –≤—ñ–¥—Å—É—Ç–Ω—è',
            sorting_instructions: '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—è',
            reusable_alternative: '–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ'
          };
          alinaQuestion = `–®—Ç—Ä–∏—Ö-–∫–æ–¥ ${barcodeInput}. –¢–æ–≤–∞—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑—ñ. –ù–∞–¥–∞–π —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ç–∏–ø–æ–≤—É —É–ø–∞–∫–æ–≤–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–ª–∞—Å—Ç–∏–∫, —Å–∫–ª–æ, –ø–∞–ø—ñ—Ä), –µ–∫–æ–ª–æ–≥—ñ—á–Ω–∏–π –≤–ø–ª–∏–≤, –ø–µ—Ä–µ—Ä–æ–±–∫—É —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –≤ –£–∫—Ä–∞—ó–Ω—ñ —É —Ñ–æ—Ä–º—ñ:\n- –ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞: [A/B/C/D/E, –ø–æ—è—Å–Ω–µ–Ω–Ω—è].\n- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ—Ä–æ–±–∫–∏: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è].\n- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó].\n- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞].`;
        } else {
          // –¢–æ–≤–∞—Ä –∑–Ω–∞–π–¥–µ–Ω–æ
          const product = data.product;
          productInfo = {
            product_name: product.product_name || '–ù–∞–∑–≤–∞ –Ω–µ–≤—ñ–¥–æ–º–∞',
            brands: product.brands || '–ù–µ–≤—ñ–¥–æ–º–æ',
            packaging: product.packaging || '–î–∞–Ω—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ',
            ingredients: product.ingredients_text || '–î–∞–Ω—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ',
            ecoscore_grade: product.ecoscore_grade ? product.ecoscore_grade.toUpperCase() : '–ù–µ–≤—ñ–¥–æ–º–æ',
            packaging_recyclability: product.packaging_recyclability || '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–µ—Ä–µ—Ä–æ–±–∫—É –≤—ñ–¥—Å—É—Ç–Ω—è',
            sorting_instructions: '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—è',
            reusable_alternative: '–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ'
          };
          alinaQuestion = `–û—Å—å –¥–∞–Ω—ñ –ø—Ä–æ —Ç–æ–≤–∞—Ä —ñ–∑ API: –ù–∞–∑–≤–∞: ${productInfo.product_name}, –ë—Ä–µ–Ω–¥: ${productInfo.brands}, –£–ø–∞–∫–æ–≤–∫–∞: ${productInfo.packaging}, –°–∫–ª–∞–¥: ${productInfo.ingredients}, –ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞: ${productInfo.ecoscore_grade}, –ü–µ—Ä–µ—Ä–æ–±–∫–∞: ${productInfo.packaging_recyclability}. –ß—ñ—Ç–∫–æ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –∫–æ–∂–µ–Ω –º–∞—Ç–µ—Ä—ñ–∞–ª —É–ø–∞–∫–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–ª–∞—Å—Ç–∏–∫, —Å–∫–ª–æ, –ø–∞–ø—ñ—Ä) —Ç–∞ —Å–∫–ª–∞–¥ –ø—Ä–æ–¥—É–∫—Ç—É –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ –µ–∫–æ–ª–æ–≥—ñ—á–Ω–æ–≥–æ –≤–ø–ª–∏–≤—É, –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –ø–µ—Ä–µ—Ä–æ–±–∫–∏ —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –≤ –£–∫—Ä–∞—ó–Ω—ñ. –Ø–∫—â–æ –µ–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ –∞–±–æ –ø–µ—Ä–µ—Ä–æ–±–∫–∞ –Ω–µ–≤—ñ–¥–æ–º—ñ, –æ—Ü—ñ–Ω–∏ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ. –ù–∞–¥–∞–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å –°–£–í–û–†–û —É —Ñ–æ—Ä–º—ñ:\n- –ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞: [A/B/C/D/E, –ø–æ—è—Å–Ω–µ–Ω–Ω—è].\n- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ—Ä–æ–±–∫–∏: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É].\n- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –£–∫—Ä–∞—ó–Ω–∏].\n- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞].`;
        }

        // –ó–∞–ø–∏—Ç –¥–æ Alina
        console.log('–ù–∞–¥—Å–∏–ª–∞—é –∑–∞–ø–∏—Ç –¥–æ Alina:', alinaQuestion);
        messages.push({ role: "user", content: alinaQuestion });
        let alinaResponse = await sendMessageToAlina(alinaQuestion, true);
        let alinaData = {
          ecoscore_grade: productInfo.ecoscore_grade,
          packaging_recyclability: productInfo.packaging_recyclability,
          sorting_instructions: productInfo.sorting_instructions,
          reusable_alternative: productInfo.reusable_alternative
        };

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Ç–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∏–π –∑–∞–ø–∏—Ç
        if (alinaResponse && !alinaResponse.includes('- –ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞:')) {
          console.log('–ù–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ Alina:', alinaResponse);
          alinaQuestion = `–¢–≤–æ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä—ñ. –î–ª—è —Ç–æ–≤–∞—Ä—É ${productInfo.product_name} (—É–ø–∞–∫–æ–≤–∫–∞: ${productInfo.packaging}, —Å–∫–ª–∞–¥: ${productInfo.ingredients}) —á—ñ—Ç–∫–æ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –∫–æ–∂–µ–Ω –º–∞—Ç–µ—Ä—ñ–∞–ª —É–ø–∞–∫–æ–≤–∫–∏ —Ç–∞ —Å–∫–ª–∞–¥. –ù–∞–¥–∞–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å –°–£–í–û–†–û —É —Ñ–æ—Ä–º—ñ:\n- –ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞: [A/B/C/D/E, –ø–æ—è—Å–Ω–µ–Ω–Ω—è].\n- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ—Ä–æ–±–∫–∏: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É].\n- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –£–∫—Ä–∞—ó–Ω–∏].\n- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞].`;
          messages.push({ role: "user", content: alinaQuestion });
          alinaResponse = await sendMessageToAlina(alinaQuestion, true);
        }

        if (alinaResponse) {
          console.log('–û—Ç—Ä–∏–º–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ Alina:', alinaResponse);
          // –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –ø–∞—Ä—Å–µ—Ä
          const lines = alinaResponse.split('\n').map(line => line.trim());
          lines.forEach(line => {
            if (line.match(/^-?\s*–ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞:/i)) {
              alinaData.ecoscore_grade = line.replace(/^-?\s*–ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞:/i, '').trim();
            } else if (line.match(/^-?\s*–ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ—Ä–æ–±–∫–∏:/i)) {
              alinaData.packaging_recyclability = line.replace(/^-?\s*–ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ—Ä–æ–±–∫–∏:/i, '').trim();
            } else if (line.match(/^-?\s*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:/i)) {
              alinaData.sorting_instructions = line.replace(/^-?\s*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:/i, '').trim();
            } else if (line.match(/^-?\s*–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:/i)) {
              alinaData.reusable_alternative = line.replace(/^-?\s*–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:/i, '').trim();
            }
          });

          // –ó–∞–ø–∞—Å–Ω—ñ –¥–∞–Ω—ñ, —è–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ–ø–æ–≤–Ω–∞
          const packaging = productInfo.packaging.toLowerCase();
          if (!alinaData.packaging_recyclability || alinaData.packaging_recyclability.includes('–≤—ñ–¥—Å—É—Ç–Ω—è')) {
            let recyclability = [];
            if (packaging.includes('plastic')) {
              recyclability.push('–ü–ª–∞—Å—Ç–∏–∫ (–π–º–æ–≤—ñ—Ä–Ω–æ, PP –∞–±–æ PET) –ø–µ—Ä–µ—Ä–æ–±–ª—é–≤–∞–Ω–∏–π –≤ –£–∫—Ä–∞—ó–Ω—ñ, —è–∫—â–æ —á–∏—Å—Ç–∏–π.');
            }
            if (packaging.includes('verre') || packaging.includes('glass')) {
              recyclability.push('–°–∫–ª–æ –ø–µ—Ä–µ—Ä–æ–±–ª—é–≤–∞–Ω–µ –≤ –£–∫—Ä–∞—ó–Ω—ñ.');
            }
            if (packaging.includes('paper') || packaging.includes('cardboard')) {
              recyclability.push('–ü–∞–ø—ñ—Ä –∞–±–æ –∫–∞—Ä—Ç–æ–Ω –ø–µ—Ä–µ—Ä–æ–±–ª—é–≤–∞–Ω—ñ, —è–∫—â–æ –Ω–µ –∑–∞–±—Ä—É–¥–Ω–µ–Ω—ñ.');
            }
            alinaData.packaging_recyclability = recyclability.length > 0 ? recyclability.join(' ') : '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–µ—Ä–µ—Ä–æ–±–∫—É –≤—ñ–¥—Å—É—Ç–Ω—è.';
          }
          if (!alinaData.sorting_instructions || alinaData.sorting_instructions.includes('–≤—ñ–¥—Å—É—Ç–Ω—è')) {
            let instructions = [];
            if (packaging.includes('plastic')) {
              instructions.push('–ü–ª–∞—Å—Ç–∏–∫: –ü—Ä–æ–º–∏–π—Ç–µ, –≤–∏—Å—É—à—ñ—Ç—å —ñ –∑–¥–∞–π—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–ª–∞—Å—Ç–∏–∫—É.');
            }
            if (packaging.includes('verre') || packaging.includes('glass')) {
              instructions.push('–°–∫–ª–æ: –û—á–∏—Å—Ç—ñ—Ç—å —ñ –∑–¥–∞–π—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–∫–ª–∞.');
            }
            if (packaging.includes('paper') || packaging.includes('cardboard')) {
              instructions.push('–ü–∞–ø—ñ—Ä/–∫–∞—Ä—Ç–æ–Ω: –ó–¥–∞–π—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–∞–ø–µ—Ä—É, —è–∫—â–æ —á–∏—Å—Ç–∏–π.');
            }
            alinaData.sorting_instructions = instructions.length > 0 ? instructions.join(' ') : '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—è.';
          }
          if (!alinaData.reusable_alternative || alinaData.reusable_alternative.includes('–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ')) {
            alinaData.reusable_alternative = packaging.includes('verre') || packaging.includes('glass')
              ? '–°–∫–ª—è–Ω—É —É–ø–∞–∫–æ–≤–∫—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∞–±–æ –¥–µ–∫–æ—Ä—É.'
              : '–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –¥–ª—è –ø–æ–¥—ñ–±–Ω–∏—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤.';
          }
          if (!alinaData.ecoscore_grade || alinaData.ecoscore_grade === '–ù–µ–≤—ñ–¥–æ–º–æ') {
            alinaData.ecoscore_grade = 'C, –ü–æ–º—ñ—Ä–Ω–∏–π –≤–ø–ª–∏–≤ —á–µ—Ä–µ–∑ –º–æ–∂–ª–∏–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–ª–∞—Å—Ç–∏–∫—É —Ç–∞ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ —ñ–∑ –≤–∏—Å–æ–∫–∏–º –≤—É–≥–ª–µ—Ü–µ–≤–∏–º —Å–ª—ñ–¥–æ–º.';
          }
        } else {
          console.log('Alina –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–ª–∞. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é –∑–∞–ø–∞—Å–Ω—ñ –¥–∞–Ω—ñ.');
          const packaging = productInfo.packaging.toLowerCase();
          alinaData = {
            ecoscore_grade: 'C, –ü–æ–º—ñ—Ä–Ω–∏–π –≤–ø–ª–∏–≤ —á–µ—Ä–µ–∑ –º–æ–∂–ª–∏–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–ª–∞—Å—Ç–∏–∫—É —Ç–∞ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ —ñ–∑ –≤–∏—Å–æ–∫–∏–º –≤—É–≥–ª–µ—Ü–µ–≤–∏–º —Å–ª—ñ–¥–æ–º.',
            packaging_recyclability: (packaging.includes('plastic') ? '–ü–ª–∞—Å—Ç–∏–∫ –ø–µ—Ä–µ—Ä–æ–±–ª—é–≤–∞–Ω–∏–π, —è–∫—â–æ —á–∏—Å—Ç–∏–π. ' : '') +
                                    (packaging.includes('verre') || packaging.includes('glass') ? '–°–∫–ª–æ –ø–µ—Ä–µ—Ä–æ–±–ª—é–≤–∞–Ω–µ. ' : '') +
                                    (packaging.includes('paper') || packaging.includes('cardboard') ? '–ü–∞–ø—ñ—Ä –ø–µ—Ä–µ—Ä–æ–±–ª—é–≤–∞–Ω–∏–π, —è–∫—â–æ —á–∏—Å—Ç–∏–π.' : ''),
            sorting_instructions: (packaging.includes('plastic') ? '–ü–ª–∞—Å—Ç–∏–∫: –ü—Ä–æ–º–∏–π—Ç–µ, –≤–∏—Å—É—à—ñ—Ç—å —ñ –∑–¥–∞–π—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–ª–∞—Å—Ç–∏–∫—É. ' : '') +
                                  (packaging.includes('verre') || packaging.includes('glass') ? '–°–∫–ª–æ: –û—á–∏—Å—Ç—ñ—Ç—å —ñ –∑–¥–∞–π—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–∫–ª–∞. ' : '') +
                                  (packaging.includes('paper') || packaging.includes('cardboard') ? '–ü–∞–ø—ñ—Ä/–∫–∞—Ä—Ç–æ–Ω: –ó–¥–∞–π—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–∞–ø–µ—Ä—É, —è–∫—â–æ —á–∏—Å—Ç–∏–π.' : ''),
            reusable_alternative: packaging.includes('verre') || packaging.includes('glass')
              ? '–°–∫–ª—è–Ω—É —É–ø–∞–∫–æ–≤–∫—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∞–±–æ –¥–µ–∫–æ—Ä—É.'
              : '–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –¥–ª—è –ø–æ–¥—ñ–±–Ω–∏—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤.'
          };
          alinaData.packaging_recyclability = alinaData.packaging_recyclability.trim() || '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–µ—Ä–µ—Ä–æ–±–∫—É –≤—ñ–¥—Å—É—Ç–Ω—è.';
          alinaData.sorting_instructions = alinaData.sorting_instructions.trim() || '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—è.';
        }

        const ecoScoreDescription = {
          'A': '–î—É–∂–µ –Ω–∏–∑—å–∫–∏–π –≤–ø–ª–∏–≤ –Ω–∞ –¥–æ–≤–∫—ñ–ª–ª—è',
          'B': '–ù–∏–∑—å–∫–∏–π –≤–ø–ª–∏–≤ –Ω–∞ –¥–æ–≤–∫—ñ–ª–ª—è',
          'C': '–ü–æ–º—ñ—Ä–Ω–∏–π –≤–ø–ª–∏–≤ –Ω–∞ –¥–æ–≤–∫—ñ–ª–ª—è',
          'D': '–í–∏—Å–æ–∫–∏–π –≤–ø–ª–∏–≤ –Ω–∞ –¥–æ–≤–∫—ñ–ª–ª—è',
          'E': '–î—É–∂–µ –≤–∏—Å–æ–∫–∏–π –≤–ø–ª–∏–≤ –Ω–∞ –¥–æ–≤–∫—ñ–ª–ª—è',
          '–ù–µ–≤—ñ–¥–æ–º–æ': '–î–∞–Ω—ñ –ø—Ä–æ –µ–∫–æ–ª–æ–≥—ñ—á–Ω–∏–π –≤–ø–ª–∏–≤ –≤—ñ–¥—Å—É—Ç–Ω—ñ'
        };

        let ecoScoreInfo = alinaData.ecoscore_grade;
        if (!ecoScoreDescription[alinaData.ecoscore_grade.split(',')[0]]) {
          ecoScoreInfo = `${alinaData.ecoscore_grade} (–î–∞–Ω—ñ –≤—ñ–¥ Alina)`;
        }

        resultDiv.innerHTML = `
          <div class="border p-4 rounded-md">
            <h2 class="text-lg font-semibold">${productInfo.product_name}</h2>
            <p><strong>–ë—Ä–µ–Ω–¥:</strong> ${productInfo.brands}</p>
            <p><strong>–ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞:</strong> ${ecoScoreInfo} (${ecoScoreDescription[productInfo.ecoscore_grade] || '–î–∞–Ω—ñ –≤—ñ–¥ Alina'})</p>
            <p><strong>–ü–∞–∫–æ–≤–∞–Ω–Ω—è:</strong> ${productInfo.packaging}</p>
            <p><strong>–°–∫–ª–∞–¥:</strong> ${productInfo.ingredients}</p>
            <p><strong>–ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ—Ä–æ–±–∫–∏:</strong> ${alinaData.packaging_recyclability}</p>
            <p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:</strong> ${alinaData.sorting_instructions}</p>
            <p><strong>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:</strong> ${alinaData.reusable_alternative}</p>
          </div>
        `;
      } catch (error) {
        resultDiv.innerHTML = '<p class="text-red-500">–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –∞–±–æ –∑–∞–ø–∏—Ç–∞–π—Ç–µ Alina.</p>';
        console.error('–ü–æ–º–∏–ª–∫–∞ Open Food Facts:', error);
      }
    }

    function startScanner() {
      const scannerContainer = document.getElementById('scanner-container');
      scannerContainer.classList.remove('hidden');

      Quagga.init({
        inputStream: {
          name: "Live",
          type: "LiveStream",
          target: document.querySelector('#scanner-video'),
          constraints: {
            facingMode: "environment"
          }
        },
        decoder: {
          readers: ["ean_reader", "upc_reader", "code_128_reader"]
        }
      }, function(err) {
        if (err) {
          document.getElementById('result').innerHTML = '<p class="text-red-500">–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å–∫–∞–Ω–µ—Ä–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏.</p>';
          console.error('–ü–æ–º–∏–ª–∫–∞ Quagga:', err);
          return;
        }
        Quagga.start();
      });

      Quagga.onDetected(function(data) {
        const barcode = data.codeResult.code;
        document.getElementById('barcode').value = barcode;
        Quagga.stop();
        scannerContainer.classList.add('hidden');
        checkProduct(barcode);
      });
    }

    function stopScanner() {
      Quagga.stop();
      document.getElementById('scanner-container').classList.add('hidden');
    }

    async function sendMessage() {
      const userMessage = userInput.value.trim();
      if (!userMessage) return;

      addMessage("–í–∏", userMessage, "bg-blue-100 text-right");
      messages.push({ role: "user", content: userMessage });
      userInput.value = "";

      await sendMessageToAlina(userMessage);
    }

    async function sendMessageToAlina(message, returnOnly = false) {
      try {
        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${apiKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: model,
            messages: messages,
            max_tokens: 500,
            temperature: 0.7
          })
        });

        if (!response.ok) {
          throw new Error(`–ü–æ–º–∏–ª–∫–∞ OpenRouter API: ${response.status}`);
        }

        const data = await response.json();
        if (!data.choices || !data.choices[0]?.message?.content) {
          throw new Error('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ OpenRouter');
        }

        const reply = data.choices[0].message.content;
        console.log('–í—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ API OpenRouter:', reply);

        if (!returnOnly) {
          addMessage("Alina", reply, "bg-green-100 text-left");
          messages.push({ role: "assistant", content: reply });
        }
        return reply;
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ OpenRouter:', error);
        if (!returnOnly) {
          addMessage("–ü–æ–º–∏–ª–∫–∞", `–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ Alina: ${error.message}`, "text-red-500 text-left");
        }
        return null;
      }
    }

    function addMessage(sender, text, className) {
      const div = document.createElement("div");
      div.className = `message p-2 rounded ${className} mb-2`;
      div.innerHTML = `<strong>${sender}:</strong> ${text}`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });
  </script>
</body>
</html>